name: Append updates after PR merge to reset

on:
  pull_request:
    types: [closed]  # Runs only when a PR is closed (merged)

jobs:
  append-update:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true && github.event.pull_request.base.ref == 'reset'  # Ensures PR is merged into reset

    steps:
      - name: Checkout the reset branch
        uses: actions/checkout@v3
        with:
          ref: reset
          fetch-depth: 0  # Ensure full history is available

      - name: Fetch "What's been added.txt" from merged PR branch
        run: |
          git fetch origin ${{ github.event.pull_request.head.ref }}
          git checkout origin/${{ github.event.pull_request.head.ref }} -- "What's been added.txt"

      - name: Append PRâ€™s "What's been added.txt" to reset branch
        run: |
          echo "" >> "What's been added.txt"  # Add a newline for formatting
          cat "What's been added.txt" >> merged_updates.txt  # Save the new content
          mv merged_updates.txt "What's been added.txt"  # Replace original file

      - name: Commit and push changes to reset
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add "What's been added.txt"
          git commit -m "Appended updates from PR #${{ github.event.pull_request.number }}"
          git push origin reset
